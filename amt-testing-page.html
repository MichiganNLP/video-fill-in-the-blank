<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Task Preview like in Amazon Mechanical Turk</title>
  <style>
      iframe {
          position: fixed;
          top: 0;
          left: 0;
          bottom: 0;
          right: 0;
          width: 100%;
          height: 100%;
          border: none;
          margin: 0;
          padding: 0;
          overflow: hidden;
          z-index: 999999;
      }
  </style>
</head>
<body>

<iframe src="about:blank">Your browser doesn't support iframes.</iframe>

<!-- The same library AMT uses to parse CSV files. -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"
        integrity="sha512-rKFvwjvE4liWPlFnvH4ZhRDfNZ9FOpdkD/BU5gAIA3VS3vOQrQ5BjKgbO3kxebKhHdHcNUHLqxQYSoxee9UwgA=="
        crossorigin="anonymous"></script>
<script type="text/javascript">
  function loadTemplatePageFromSubstitutions(templatePagePath, substitutions) {
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = () => {
      if (xhr.readyState === XMLHttpRequest.DONE) {
        const htmlContent = Object.entries(substitutions).reduce((content, [k, v]) => content.replaceAll(`\${${k}}`, v),
            xhr.responseText);

        const doc = document.getElementsByTagName("iframe")[0].contentWindow.document;
        doc.open();
        doc.write(htmlContent);
        doc.close();
      }
    };
    xhr.open("GET", templatePagePath);
    xhr.send();
  }

  function loadAndFillTemplatePage(templatePagePath, dataPath) {
    Papa.parse(dataPath, {
      download: true,
      header: true,
      skipEmptyLines: true,
      error: alert,
      complete: result => loadTemplatePageFromSubstitutions(templatePagePath, result.data[0]),
    });
  }

  function onDomContentLoaded() {
    const urlParams = new URLSearchParams(window.location.search);
    const templatePagePath = urlParams.get("templatePagePath") || "multi-video-one-by-one.html";
    const dataPath = urlParams.get("dataPath") || "VATEX-first-batch-val-1-10.csv";
    loadAndFillTemplatePage(templatePagePath, dataPath);
  }

  function main() {
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", onDomContentLoaded);
    } else {
      onDomContentLoaded();
    }
  }

  main();
</script>

</body>
</html>
