<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
<script async src="https://www.youtube.com/iframe_api"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
        
<script type="text/javascript">
    function onDOMContentLoaded() {
        // var answerInputInnerHtml = '<input type="text" class="form-control" id="answer" name="answer" minlength="1"' +
        // ' maxlength="20" size="20" required placeholder="answer" autocomplete="off"></input>';
		var answerInputInnerHtml = '<textarea type="text" class="form-control" id="answer" name="answer"' +
		'minlength="1" maxlength="30" size="30" rows="2" cols="30" required autocomplete="off" '+ 
		'placeholder="Please enter one or more possible answers (See Instruction). ' +
		'Strat a new line after each answer."></textarea>';
    
        var $question = document.getElementById('question');
        var $guessAnswer = document.getElementById('guess-answer');
        var $part2 = document.getElementById('part2');
        
        $question.innerHTML = '${question}'.replace('_____', answerInputInnerHtml);
        
        var $answer = document.getElementById('answer');
        
        window.onload = () => {
            $guessAnswer.value = $answer.value;
            $answer.value = '';
            $part2.style.display = 'block';
            var player = new YT.Player('video', {
                //height: '720',
                //width: '1280',
                videoId: '${video_id}',
                playerVars: {
                    autoplay: 1,
                    controls: 1,
                    showinfo: 0,
                    modestbranding: 1,
                    fs: 1,                  // full screen button
                    cc_load_policy: 0,      // Hide closed captions
                    iv_load_policy: 3,      // Hide the Video Annotations
                    start: parseInt('${video_start_time}'),
                    end: parseInt('${video_end_time}'),
                    autohide: 1, // Hide video controls when playing
                    rel: 0,
                },
                events: {
                    'onStateChange': state => {
                        if (state.data === YT.PlayerState.ENDED) {
                            videoWasStopped = true;
                        } else if (state.data === YT.PlayerState.PLAYING && videoWasStopped) {
                            player.seekTo(startTime);
                            videoWasStopped = false;
                        }
                    },
                }
            });
        };
    }
    
    function main() {
        document.addEventListener('DOMContentLoaded', onDOMContentLoaded);
    }
    
    main();
</script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<style>
    #instructions, li, #user {
        color: gray;
    }
    
    #question {
        margin: auto auto 20px auto;
        text-align: center;
    }
    
    #answer {
        text-align: center;
    }
    
    #part2 {
        display: none;
    }
    
    #video {
        display: block;
        height: 360px;
        margin: 10px auto;
    }
    
    #loading-video {
        position: relative;
        top: 50%;
        text-align: center;
    }
    
    button {
        margin-bottom: 20px;
    }
</style>

<div class="container">
    <h1>QGen Annotation</h1>
    <hr>
    <crowd-form>
		<short-instructions>
            <p>Fill in the blank based on the video (images and/or audio).</p>
            <p>You could fill in one or more <u><b> approprate </b></u> 
			answers, and start a new line for each answer. Please refer to
			the full Instructions for more details and examples.</p>
        </short-instructions>

        <!-- Use the full-instructions section for more detailed instructions that the 
              Worker can open while working on the task. Including more detailed 
              instructions and additional examples of good and bad answers here can
              help get good results. You can include any HTML here. -->
        <full-instructions header="Classification Instructions">
            <p>Fill in the blank based on the video (images and/or audio).</p>
			
            <p>You could fill in one or more approprate answers. For example:<br>
			If you see a <i>small dalmatian</i> in the video, both <i>dalmatian,</i>
			<i>dog,</i> <i>pet</i> and <i>puppy</i> are approprate answers, but neither 
			<i>object</i> or <i>cat</i> is approprate.</p>
			
			<p>Pay attention to the following<br>
			<ul>
			<li>We will check the appropriateness of the answers;</li>
			<li>Generally speaking, the more answers you provide for each problems, the more likely you are to pass the test;</li>
			<li>We will give extra rewards to the workers with the highest acceptance rate;</li>
			<li>Start a new line for each answer;</li>
			<li>When you enter numbers, please enter digital numbers instead of text. (For example: enter 1 instead of one).</li>
			</ul>
			</p>
        </full-instructions>
    
        <div id="instance">
		
            <div class="form-inline">
                <h3 id="question">${question}</h3>
            </div>

            <crowd-input type="hidden" id="guess-answer" name="guess_answer"></crowd-input>

            <div id="part2" class="form-group">
                <div id="video">
                    <p id="loading-video">Loading videoâ€¦</p>
                </div>

                <label for="comments"><strong>Comments</strong></label>
                <textarea class="form-control" id="comments" name="comments" rows="2"
                        placeholder="Please, write any comment/error/suggestion you have."></textarea>
            </div>
        </div>
    </crowd-form>
</div>