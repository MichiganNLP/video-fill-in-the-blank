<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
<script async src="https://www.youtube.com/iframe_api"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
        
<script type="text/javascript">
    function onDOMContentLoaded() {
        var answerInputInnerHtml = '<input type="text" class="form-control" id="answer" name="answer" minlength="1"' +
        ' maxlength="20" size="20" required placeholder="answer" autocomplete="off"></input>';
        // var answerInputInnerHtml = '<crowd-input name="favoriteColor" placeholder="answer" autocomplete="off" required></crowd-input>'
    
        var $question = document.getElementById('question');
        var $nextButton = document.getElementById('next');
        var $guessAnswer = document.getElementById('guess-answer');
        var $part2 = document.getElementById('part2');
        
        $question.innerHTML = '${question}'.replace('_____', answerInputInnerHtml);
        
        var $answer = document.getElementById('answer');
        
        $nextButton.onclick = () => {
            $guessAnswer.value = $answer.value;
            $answer.value = '';
            $part2.style.display = 'block';
            var player = new YT.Player('video', {
                //height: '720',
                //width: '1280',
                videoId: '${video_id}',
                playerVars: {
                    autoplay: 1,
                    controls: 1,
                    showinfo: 0,
                    modestbranding: 1,
                    fs: 1,                  // full screen button
                    cc_load_policy: 0,      // Hide closed captions
                    iv_load_policy: 3,      // Hide the Video Annotations
                    start: parseInt('${video_start_time}'),
                    end: parseInt('${video_end_time}'),
                    autohide: 1, // Hide video controls when playing
                    rel: 0,
                },
                events: {
                    'onStateChange': state => {
                        if (state.data === YT.PlayerState.ENDED) {
                            videoWasStopped = true;
                        } else if (state.data === YT.PlayerState.PLAYING && videoWasStopped) {
                            player.seekTo(startTime);
                            videoWasStopped = false;
                        }
                    },
                }
            });
            var nextParent = $nextButton.parentElement;
            nextParent.removeChild($nextButton);
        };
    }
    
    function validateForm() {
        if (!document.getElementById("next"))
        return true;
        else
        return false;
        }
    
    function main() {
        document.addEventListener('DOMContentLoaded', onDOMContentLoaded);
        window.onload = function(){
            var $submitButton = document.getElementsByTagName("crowd-button");
            $submitButton[0].setAttribute('onclick', 'return validateForm()'); 
        }
    }
    
    main();
</script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<style>
    #instructions, li, #user {
        color: gray;
    }
    
    #question {
        margin: auto auto 20px auto;
        text-align: center;
    }
    
    #answer {
        text-align: center;
    }
    
    #part2 {
        display: none;
    }
    
    #video {
        display: block;
        height: 360px;
        margin: 10px auto;
    }
    
    #loading-video {
        position: relative;
        top: 50%;
        text-align: center;
    }
    
    button {
        margin-bottom: 20px;
    }
</style>

<div class="container">
    <h1>QGen Annotation</h1>
    
    <crowd-form>

        <details id="instructions">
            <p>We need help validating this VideoQA dataset, so your help is really useful. Instructions:</p>
    
            <summary>Instructions</summary>
    
            <ol>
                <li>
                    One instance at a time is shown.
                    You will see a broken sentence with a missing word replaced by a blank ("_____").
                    You need to guess the missing word.
                    When you select your answer, hit "Next" and a video will be shown.
                </li>
                <li>
                    After the video is shown, try to fill in the blank the same sentence again,
                    but this time please do it based on the information from the video (images and/or audio).
                    The filled word when the video is present could be different from the one when the video isn't present.
                    When you are done, hit "Submit" and the next instance will be shown.
                </li>
            </ol>
    
            <p>
                When there are no more instances available, a message will be displayed.
                In case the video gets stuck, feel free to refresh the page.
            </p>
        </details>
    
        <hr>
    
        <div id="instance">
            <p id="instruction-statement">Please, fill in the blank with your best guess:</p>
    
            <div class="form-inline">
                <h2 id="question">${question}</h2>
            </div>

            <crowd-input type="hidden" id="guess-answer" name="guess_answer"></crowd-input>

            <div id="part2" class="form-group">
                <div id="video">
                    <p id="loading-video">Loading videoâ€¦</p>
                </div>

                <label for="comments">Comments</label>
                <crowd-textarea class="form-control" id="comments" name="comments" rows="2"
                        placeholder="Please, write any comment/error/suggestion you have."></crowd-textarea>
            </div>
            <button type="button" id="next" class="btn btn-secondary">Next</button>
        </div>
    </crowd-form>
</div>